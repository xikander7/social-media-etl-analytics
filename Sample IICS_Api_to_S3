# Source transformation for Twitter API
src_twitter = IICS::Source.new('Twitter API')

# Set up Twitter API configuration
src_twitter.connector = 'Twitter'
src_twitter.endpoint = 'https://api.twitter.com'
src_twitter.authentication_type = 'OAuth'
src_twitter.consumer_key = '$TWITTER_CONSUMER_KEY' 
src_twitter.consumer_secret = '$TWITTER_CONSUMER_SECRET'
src_twitter.access_token = '$TWITTER_ACCESS_TOKEN'
src_twitter.access_token_secret = '$TWITTER_ACCESS_TOKEN_SECRET'

# Specify API resource and parameters
src_twitter.resource = '/2/tweets/search/recent' 
src_twitter.parameters['query'] = 'source=Informatica'
src_twitter.parameters['max_results'] = 100

# Target for AWS S3
tgt_s3 = IICS::Target.new('S3 Target')
tgt_s3.connector = 'AWS S3'
tgt_s3.bucket = '$S3_BUCKET_NAME'
tgt_s3.key = 'twitter_data'
tgt_s3.format = 'json'

# Mapping between source and target
map_stm = IICS::Mapping.new(src_twitter, tgt_s3)

# Pipeline execution
pipe_run = Pipeline.new.deploy(map_stm)
pipe_run.run()
